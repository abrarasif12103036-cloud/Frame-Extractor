<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frame Extractor — Camera UI</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="styles.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Frame Extractor</a>
      <span class="text-muted">Extract frames every 0.1s (10 FPS)</span>
    </div>
  </nav>

  <div class="container">
    <div class="row">
      <div class="col-lg-6">
        <div id="drop-area" class="card p-4 text-center">
          <h5 class="card-title fw-bold mb-3">Drop a video file here or click to select</h5>
          <input id="file" type="file" accept="video/*" class="form-control-file d-none" />
          <button id="browse" class="btn btn-primary mt-3">Choose a video</button>
          <div id="file-info" class="mt-3 text-muted small"></div>

          <div class="mt-3">
            <label for="interval" class="form-label">Frame interval (s)</label>
            <div class="input-group mb-3">
              <input id="interval" type="number" min="0.01" max="5.0" step="0.01" value="0.1" class="form-control w-auto">
              <span class="input-group-text">seconds</span>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Tracking Options</label>
              <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" id="enable-tracking">
                <label class="form-check-label" for="enable-tracking">Enable Tracking</label>
              </div>
            </div>

            <div class="mb-3">
              <label for="color-picker" class="form-label">Target Color</label>
              <div class="input-group">
                <input id="color-picker" type="color" value="#FF0000" class="form-control form-control-color" style="max-width: 60px;">
                <input id="color-hex" type="text" class="form-control" placeholder="#RRGGBB" value="FF0000">
                <span class="input-group-text" id="color-preview" style="background-color: #FF0000; width: 50px;"></span>
                <button id="eyedropper-btn" class="btn btn-outline-secondary" type="button" title="Click to activate eyedropper, then click on an image to extract color">
                  Eyedropper
                </button>
              </div>
              <small class="text-muted">Pick the color or use eyedropper to sample from an image</small>
              <input id="eyedropper-file-input" type="file" accept="image/*" style="display: none;">
              <div id="eyedropper-canvas-container" class="mt-2" style="display: none;">
                <canvas id="eyedropper-canvas" style="max-width: 100%; border: 2px solid #ccc; cursor: crosshair;"></canvas>
                <p class="text-center text-muted small mt-2">Click on the image to pick a color. Press ESC to cancel.</p>
              </div>
            </div>

            <div class="mb-3">
              <label for="accuracy" class="form-label small">Detection Accuracy (Min Pixels)</label>
              <input id="accuracy" type="range" min="10" max="500" value="20" class="form-range">
              <small id="accuracy-value" class="text-muted">20 pixels</small>
            </div>

            <div class="d-grid gap-2">
              <button id="upload" class="btn btn-success btn-lg" disabled>Upload & Extract</button>
              <button id="demo" class="btn btn-outline-primary mt-2">Demo Tracking</button>
            </div>
          </div>

          <div class="progress progress-sm mt-3" style="height: 18px; display:none;" id="progress-wrap">
            <div id="progress" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
          </div>

          <div id="error-bar" class="alert alert-danger mt-3" style="display: none; margin-bottom: 0;"></div>

          <div id="status" class="mt-3"></div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card p-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0 fw-bold">Results</h5>
            <div id="frame-count" class="text-muted small">No frames yet</div>
          </div>

          <!-- Data Sheet Table -->
          <div id="data-sheet-container" style="display: none; margin-bottom: 20px;">
            <h6 class="mb-2 fw-bold">Frame Data Sheet</h6>
            <div style="max-height: 250px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 6px;">
              <table class="table table-sm table-hover mb-0">
                <thead class="table-light" style="position: sticky; top: 0;">
                  <tr>
                    <th style="width: 20%;">Frame</th>
                    <th style="width: 25%;">X</th>
                    <th style="width: 25%;">Y</th>
                    <th style="width: 30%;">Time (s)</th>
                  </tr>
                </thead>
                <tbody id="data-sheet-body">
                </tbody>
              </table>
            </div>
            <div class="mt-2">
              <a id="download-csv" class="btn btn-outline-info btn-sm d-none" download="frame_data.csv">Download CSV</a>
              <button id="plot-x-btn" class="btn btn-outline-success btn-sm d-none">Show X vs Time Plot</button>
              <button id="plot-y-btn" class="btn btn-outline-success btn-sm d-none">Show Y vs Time Plot</button>
            </div>
          </div>

          <!-- Plot Modal -->
          <div id="plot-modal" class="modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 82%; max-width: 880px; height: auto; background: transparent; z-index: 9999; overflow: visible; visibility: hidden; opacity: 0; transition: opacity 0.3s ease;">
            <div style="position: relative; background: white; border-radius: 10px; width: 100%; display: flex; flex-direction: column; height: auto; box-shadow: 0 6px 25px rgba(0,0,0,0.15); max-height: 80vh; overflow: hidden;">
              <div style="padding: 1.2rem; border-bottom: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; background: linear-gradient(to right, #f8f9fa, #ffffff);">
                <h5 style="margin: 0; font-weight: 600; font-size: 1rem;" id="plot-title">Plot</h5>
                <button id="plot-close-btn" style="background: none; border: none; font-size: 1.8rem; cursor: pointer; color: #6c757d; padding: 0; line-height: 1;">&times;</button>
              </div>
              <div style="flex: 0 0 auto; padding: 1.2rem; background-color: #ffffff;">
                <div id="plot-container" style="width: 100%; height: 420px; position: relative; border-radius: 6px; background: white;"></div>
              </div>
              <div style="padding: 1rem; border-top: 1px solid #dee2e6; text-align: right; flex-shrink: 0; background-color: #f8f9fa;">
                <button id="plot-save-btn" class="btn btn-outline-primary btn-sm">Save as PNG</button>
                <button id="plot-close-btn2" class="btn btn-outline-secondary btn-sm">Close</button>
              </div>
            </div>
          </div>

          <div class="mb-2">
            <a id="download-link" class="btn btn-outline-primary me-2 d-none" download="frames.zip">Download frames.zip</a>
            <button id="show-thumbs" class="btn btn-outline-secondary d-none">Show thumbnails</button>
            <button id="clear" class="btn btn-outline-danger">Clear</button>
          </div>

          <div id="thumb-grid" class="row g-2" style="max-height:420px; overflow:auto;"></div>
        </div>
      </div>
    </div>

    <!-- Pixel to Millimeter Conversion Section -->
    <div class="row mt-4" id="conversion-section" style="display: none;">
      <div class="col-lg-12">
        <div class="card p-3">
          <h5 class="mb-2 fw-bold">Pixel to Millimeter Conversion</h5>
          <p class="small text-muted mb-3">Convert pixel coordinates to millimeters for distance measurement.</p>
          
          <div class="row">
            <div class="col-md-5">
              <div class="card p-2" style="border: none; border-left: 3px solid #0d6efd;">
                <label class="form-label fw-bold mb-1">X Axis (px/mm)</label>
                <div class="input-group">
                  <input id="px-mm-x-input" type="number" step="0.1" placeholder="pixels/mm" class="form-control" value="1">
                  <span class="input-group-text">px/mm</span>
                </div>
                <button id="apply-x-conversion" class="btn btn-primary btn-sm mt-2 w-100">Apply</button>
              </div>
            </div>

            <div class="col-md-5">
              <div class="card p-2" style="border: none; border-left: 3px solid #0d6efd;">
                <label class="form-label fw-bold mb-1">Y Axis (px/mm)</label>
                <div class="input-group">
                  <input id="px-mm-y-input" type="number" step="0.1" placeholder="pixels/mm" class="form-control" value="1">
                  <span class="input-group-text">px/mm</span>
                </div>
                <button id="apply-y-conversion" class="btn btn-primary btn-sm mt-2 w-100">Apply</button>
              </div>
            </div>

            <div class="col-md-2">
              <div class="card p-2" style="border: none; display: flex; align-items: flex-end; height: 100%;">
                <button id="reset-conversions" class="btn btn-outline-primary btn-sm w-100">Reset</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Converted Data Sheets Section -->
    <div class="row mt-4" id="conversion-data-section" style="display: none;">
      <div class="col-lg-6">
        <div class="card p-3">
          <h6 class="mb-2 fw-bold">X Distance (mm)</h6>
          <div id="mm-x-data-sheet-container" style="display: none;">
            <div style="max-height: 250px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 6px;">
              <table class="table table-sm table-hover mb-0">
                <thead class="table-light" style="position: sticky; top: 0;">
                  <tr>
                    <th style="width: 25%;">Frame</th>
                    <th style="width: 35%;">Distance (mm)</th>
                    <th style="width: 40%;">Time (s)</th>
                  </tr>
                </thead>
                <tbody id="mm-x-data-sheet-body">
                </tbody>
              </table>
            </div>
            <div class="mt-2">
              <button id="plot-mm-x-btn" class="btn btn-outline-primary btn-sm">Show X Distance Plot</button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card p-3">
          <h6 class="mb-2 fw-bold">Y Distance (mm)</h6>
          <div id="mm-y-data-sheet-container" style="display: none;">
            <div style="max-height: 250px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 6px;">
              <table class="table table-sm table-hover mb-0">
                <thead class="table-light" style="position: sticky; top: 0;">
                  <tr>
                    <th style="width: 25%;">Frame</th>
                    <th style="width: 35%;">Distance (mm)</th>
                    <th style="width: 40%;">Time (s)</th>
                  </tr>
                </thead>
                <tbody id="mm-y-data-sheet-body">
                </tbody>
              </table>
            </div>
            <div class="mt-2">
              <button id="plot-mm-y-btn" class="btn btn-outline-primary btn-sm">Show Y Distance Plot</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="mt-4 pt-3 text-muted small text-center">
      <p>Tip: Use small test videos first (1–5s) until you're comfortable with settings.</p>
      <p class="mt-2">Made By Md. Abrar Asif</p>
    </footer>
  </div>

  <!-- JS: Bootstrap, JSZip, Plotly, and app script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="upload.js"></script>
</body>
</html>